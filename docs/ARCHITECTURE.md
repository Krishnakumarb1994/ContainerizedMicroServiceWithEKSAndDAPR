# E-Commerce Platform - Architecture Diagram

## System Architecture Overview

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        AWS Cloud (us-west-2)                                         │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                      │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                              Amazon EKS Cluster (ecommerce-eks-cluster)                        │ │
│  │                                      Kubernetes v1.29                                          │ │
│  ├────────────────────────────────────────────────────────────────────────────────────────────────┤ │
│  │                                                                                                │ │
│  │  ┌──────────────────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                              Namespace: ecommerce                                         │ │ │
│  │  ├──────────────────────────────────────────────────────────────────────────────────────────┤ │ │
│  │  │                                                                                          │ │ │
│  │  │  ┌─────────────────────┐    ┌─────────────────────┐    ┌─────────────────────┐          │ │ │
│  │  │  │   ProductService    │    │    CartService      │    │    OrderService     │          │ │ │
│  │  │  │   ┌─────────────┐   │    │   ┌─────────────┐   │    │   ┌─────────────┐   │          │ │ │
│  │  │  │   │   Flask     │   │    │   │   Flask     │   │    │   │   Flask     │   │          │ │ │
│  │  │  │   │   :5001     │   │    │   │   :5002     │   │    │   │   :5003     │   │          │ │ │
│  │  │  │   └──────┬──────┘   │    │   └──────┬──────┘   │    │   └──────┬──────┘   │          │ │ │
│  │  │  │          │          │    │          │          │    │          │          │          │ │ │
│  │  │  │   ┌──────┴──────┐   │    │   ┌──────┴──────┐   │    │   ┌──────┴──────┐   │          │ │ │
│  │  │  │   │Dapr Sidecar │   │    │   │Dapr Sidecar │   │    │   │Dapr Sidecar │   │          │ │ │
│  │  │  │   │   :3500     │   │    │   │   :3500     │   │    │   │   :3500     │   │          │ │ │
│  │  │  │   └──────┬──────┘   │    │   └──────┬──────┘   │    │   └──────┬──────┘   │          │ │ │
│  │  │  └──────────┼──────────┘    └──────────┼──────────┘    └──────────┼──────────┘          │ │ │
│  │  │             │                          │                          │                      │ │ │
│  │  │             │    ┌─────────────────────┐    ┌─────────────────────┐                      │ │ │
│  │  │             │    │   PaymentService    │    │                     │                      │ │ │
│  │  │             │    │   ┌─────────────┐   │    │   Dapr Components   │                      │ │ │
│  │  │             │    │   │   Flask     │   │    │   ┌─────────────┐   │                      │ │ │
│  │  │             │    │   │   :5004     │   │    │   │  pubsub     │   │                      │ │ │
│  │  │             │    │   └──────┬──────┘   │    │   │  statestore │   │                      │ │ │
│  │  │             │    │          │          │    │   │  secretstore│   │                      │ │ │
│  │  │             │    │   ┌──────┴──────┐   │    │   └─────────────┘   │                      │ │ │
│  │  │             │    │   │Dapr Sidecar │   │    │                     │                      │ │ │
│  │  │             │    │   │   :3500     │   │    └─────────────────────┘                      │ │ │
│  │  │             │    │   └──────┬──────┘   │                                                 │ │ │
│  │  │             │    └──────────┼──────────┘                                                 │ │ │
│  │  │             │               │                                                            │ │ │
│  │  └─────────────┼───────────────┼────────────────────────────────────────────────────────────┘ │ │
│  │                │               │                                                              │ │
│  │  ┌─────────────┼───────────────┼─────────────────────────────────────────────────────────┐   │ │
│  │  │             │   Namespace: dapr-system                                                │   │ │
│  │  │             │                                                                         │   │ │
│  │  │  ┌──────────┴───────────────┴──────────────────────────────────────────────────────┐ │   │ │
│  │  │  │                         Dapr Control Plane                                       │ │   │ │
│  │  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐ │ │   │ │
│  │  │  │  │ dapr-operator│  │dapr-sentry │  │dapr-placement│  │dapr-sidecar-injector  │ │ │   │ │
│  │  │  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────────────────┘ │ │   │ │
│  │  │  └─────────────────────────────────────────────────────────────────────────────────┘ │   │ │
│  │  └───────────────────────────────────────────────────────────────────────────────────────┘   │ │
│  │                                                                                              │ │
│  └──────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                │                                                  │
│                                                │                                                  │
│  ┌─────────────────────────────────────────────┴──────────────────────────────────────────────┐  │
│  │                              AWS Messaging Services                                         │  │
│  │                                                                                             │  │
│  │  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │  │
│  │  │                              Amazon SNS (Topics)                                      │  │  │
│  │  │  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐      │  │  │
│  │  │  │ product-events │  │  cart-events   │  │  order-events  │  │ payment-events │      │  │  │
│  │  │  └───────┬────────┘  └───────┬────────┘  └───────┬────────┘  └───────┬────────┘      │  │  │
│  │  │          │                   │                   │                   │               │  │  │
│  │  └──────────┼───────────────────┼───────────────────┼───────────────────┼───────────────┘  │  │
│  │             │                   │                   │                   │                  │  │
│  │  ┌──────────┼───────────────────┼───────────────────┼───────────────────┼───────────────┐  │  │
│  │  │          ▼                   ▼                   ▼                   ▼               │  │  │
│  │  │                              Amazon SQS (Queues)                                      │  │  │
│  │  │  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐      │  │  │
│  │  │  │product-events- │  │ cart-events-   │  │ order-events-  │  │payment-events- │      │  │  │
│  │  │  │     queue      │  │     queue      │  │     queue      │  │     queue      │      │  │  │
│  │  │  └────────────────┘  └────────────────┘  └────────────────┘  └────────────────┘      │  │  │
│  │  │                                                                                       │  │  │
│  │  │                              ┌────────────────┐                                       │  │  │
│  │  │                              │  ecommerce-dlq │ (Dead Letter Queue)                   │  │  │
│  │  │                              └────────────────┘                                       │  │  │
│  │  └───────────────────────────────────────────────────────────────────────────────────────┘  │  │
│  │                                                                                             │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                   │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                              Observability & Storage                                         │  │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐         │  │
│  │  │  CloudWatch     │  │    Amazon ECR   │  │ DynamoDB (State)│  │Secrets Manager  │         │  │
│  │  │  Logs/Metrics   │  │  (Container     │  │                 │  │                 │         │  │
│  │  │                 │  │   Registry)     │  │                 │  │                 │         │  │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘         │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                   │
└───────────────────────────────────────────────────────────────────────────────────────────────────┘
```

## Event Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                              Pub/Sub Event Flow                                              │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

                                    CHECKOUT FLOW
                                    ─────────────

  ┌──────────────┐         ┌──────────────┐         ┌──────────────┐         ┌──────────────┐
  │              │         │              │         │              │         │              │
  │   Customer   │────────▶│  CartService │────────▶│ OrderService │────────▶│PaymentService│
  │              │         │              │         │              │         │              │
  └──────────────┘         └──────┬───────┘         └──────┬───────┘         └──────┬───────┘
                                  │                        │                        │
                                  │                        │                        │
                           ┌──────▼───────┐         ┌──────▼───────┐         ┌──────▼───────┐
                           │ Dapr Sidecar │         │ Dapr Sidecar │         │ Dapr Sidecar │
                           └──────┬───────┘         └──────┬───────┘         └──────┬───────┘
                                  │                        │                        │
                                  │ PUBLISH                │ PUBLISH                │ PUBLISH
                                  │ order.created          │ payment.requested      │ payment.completed
                                  ▼                        ▼                        ▼
                         ┌────────────────────────────────────────────────────────────────┐
                         │                       AWS SNS Topics                           │
                         │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
                         │  │order-events │  │order-events │  │payment-events│            │
                         │  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘            │
                         └─────────┼────────────────┼────────────────┼────────────────────┘
                                   │                │                │
                                   ▼                ▼                ▼
                         ┌────────────────────────────────────────────────────────────────┐
                         │                       AWS SQS Queues                           │
                         │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
                         │  │order-events │  │payment-events│ │payment-events│            │
                         │  │   queue     │  │   queue     │  │   queue     │            │
                         │  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘            │
                         └─────────┼────────────────┼────────────────┼────────────────────┘
                                   │                │                │
                                   │ SUBSCRIBE      │ SUBSCRIBE      │ SUBSCRIBE
                                   ▼                ▼                ▼
                           ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
                           │ OrderService │  │PaymentService│  │ OrderService │
                           │ (Subscriber) │  │ (Subscriber) │  │ (Subscriber) │
                           └──────────────┘  └──────────────┘  └──────────────┘


                              PRODUCT UPDATE FLOW
                              ───────────────────

  ┌──────────────┐                                              ┌──────────────┐
  │    Admin     │                                              │  CartService │
  │              │         ┌──────────────┐                     │ (Subscriber) │
  │  (Update     │────────▶│ProductService│─────────────────────▶│              │
  │   Product)   │         │              │                     │(Updates cart │
  └──────────────┘         └──────┬───────┘                     │ item prices) │
                                  │                             └──────────────┘
                                  │ PUBLISH
                                  │ product.updated
                                  ▼
                         ┌───────────────┐         ┌───────────────┐
                         │   SNS Topic   │────────▶│   SQS Queue   │
                         │product-events │         │product-events │
                         └───────────────┘         └───────┬───────┘
                                                           │
                                                           │ SUBSCRIBE
                                                           ▼
                                                   ┌──────────────┐
                                                   │  CartService │
                                                   └──────────────┘
```

## Network Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              VPC: 10.0.0.0/16                                            │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│  Availability Zone: us-west-2a    │  us-west-2b           │  us-west-2c                 │
│  ─────────────────────────────    │  ─────────────────    │  ─────────────────          │
│                                   │                       │                              │
│  ┌───────────────────────────┐    │  ┌────────────────┐   │  ┌────────────────┐         │
│  │  Public Subnet            │    │  │ Public Subnet  │   │  │ Public Subnet  │         │
│  │  10.0.1.0/24              │    │  │ 10.0.2.0/24    │   │  │ 10.0.3.0/24    │         │
│  │  ┌─────────────────────┐  │    │  │                │   │  │                │         │
│  │  │   NAT Gateway       │  │    │  │  NAT Gateway   │   │  │  NAT Gateway   │         │
│  │  │   Internet Gateway  │  │    │  │                │   │  │                │         │
│  │  └─────────────────────┘  │    │  │                │   │  │                │         │
│  └───────────────────────────┘    │  └────────────────┘   │  └────────────────┘         │
│                                   │                       │                              │
│  ┌───────────────────────────┐    │  ┌────────────────┐   │  ┌────────────────┐         │
│  │  Private Subnet           │    │  │ Private Subnet │   │  │ Private Subnet │         │
│  │  10.0.10.0/24             │    │  │ 10.0.11.0/24   │   │  │ 10.0.12.0/24   │         │
│  │                           │    │  │                │   │  │                │         │
│  │  ┌─────────────────────┐  │    │  │ ┌────────────┐ │   │  │ ┌────────────┐ │         │
│  │  │   EKS Worker Node   │  │    │  │ │ EKS Worker │ │   │  │ │ EKS Worker │ │         │
│  │  │   (t3.medium)       │  │    │  │ │   Node     │ │   │  │ │   Node     │ │         │
│  │  │                     │  │    │  │ │            │ │   │  │ │            │ │         │
│  │  │  ┌───────────────┐  │  │    │  │ │            │ │   │  │ │            │ │         │
│  │  │  │Product Service│  │  │    │  │ │Cart Service│ │   │  │ │Order Svc   │ │         │
│  │  │  │+ Dapr Sidecar │  │  │    │  │ │+ Dapr      │ │   │  │ │+ Dapr      │ │         │
│  │  │  └───────────────┘  │  │    │  │ │            │ │   │  │ │            │ │         │
│  │  │  ┌───────────────┐  │  │    │  │ │            │ │   │  │ │            │ │         │
│  │  │  │Payment Service│  │  │    │  │ └────────────┘ │   │  │ └────────────┘ │         │
│  │  │  │+ Dapr Sidecar │  │  │    │  │                │   │  │                │         │
│  │  │  └───────────────┘  │  │    │  │                │   │  │                │         │
│  │  └─────────────────────┘  │    │  │                │   │  │                │         │
│  └───────────────────────────┘    │  └────────────────┘   │  └────────────────┘         │
│                                   │                       │                              │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

## Component Interactions

| Source Service | Event Type | Topic | Subscribers |
|---------------|------------|-------|-------------|
| ProductService | product.created | product-events | CartService, OrderService |
| ProductService | product.updated | product-events | CartService |
| ProductService | product.deleted | product-events | CartService |
| CartService | cart.item_added | cart-events | OrderService |
| CartService | cart.checkout_completed | order-events | OrderService |
| OrderService | order.created | order-events | PaymentService |
| OrderService | order.confirmed | order-events | ProductService |
| PaymentService | payment.requested | payment-events | PaymentService |
| PaymentService | payment.completed | payment-events | OrderService |
| PaymentService | payment.failed | payment-events | OrderService |

## Port Mappings

| Service | Container Port | Service Port | Dapr Port | Metrics Port |
|---------|---------------|--------------|-----------|--------------|
| ProductService | 5001 | 80 | 3500 | 9090 |
| CartService | 5002 | 80 | 3500 | 9090 |
| OrderService | 5003 | 80 | 3500 | 9090 |
| PaymentService | 5004 | 80 | 3500 | 9090 |
